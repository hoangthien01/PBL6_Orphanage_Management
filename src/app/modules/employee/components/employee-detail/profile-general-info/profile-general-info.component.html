<div class="profile-general-info-page">
    <app-load-panel [isLoading]="false">
    </app-load-panel>

    <dx-scroll-view class="profile-general-info-scroll-view"
                    [showScrollbar]="'always'"
                    [direction]="'both'">
        <div class="profile-general-info-wrapper pl-10-c pr-30-c">
            <div class="form-wrapper">
                <div class="general-info-section">
                    <div class="left-section pb-64-c">
                        <div class="section-summary__title pb-24-c">Thông tin người dùng</div>
                        <div class="box-properties">
                            <app-profile-avatar [avatarParentComponent]="AVATAR_PARENT_COMPONENT.profile"
                                                [fileAvatarName]="profileGeneralInfo.avatar"
                                                [logoTitle]="'Ảnh cá nhân'"
                                                [disabled]="isSaving"
                                                (avatarUpdated)="onAvatarUpdated($event)">
                            </app-profile-avatar>
                        </div>

                        <div class="box-properties" appAutoFocusInput>
                            <span class="field-label">Họ và tên</span>
                            <dx-text-box class="field-box"
                                         [disabled]="isSaving"
                                         [placeholder]="'John Smith'"
                                         [valueChangeEvent]="'input'"
                                         [(value)]="profileGeneralInfo.name"
                                         (onValueChanged)="dataChanged()">
                                <dx-validator>
                                    <dxi-validation-rule type="required"
                                                         [message]="'This full name is required'">
                                    </dxi-validation-rule>
                                </dx-validator>
                            </dx-text-box>
                        </div>

                        <div class="box-properties" appAutoFocusInput>
                            <span class="field-label">Địa chỉ</span>
                            <dx-text-box class="field-box"
                                         [disabled]="isSaving"
                                         [placeholder]="'Da Nang...'"
                                         [valueChangeEvent]="'input'"
                                         [(value)]="profileGeneralInfo.name"
                                         (onValueChanged)="dataChanged()">
                            </dx-text-box>
                        </div>

                        <div class="box-properties" appAutoFocusInput>
                            <span class="field-label">Số điện thoại</span>
                            <dx-text-box class="field-box"
                                         [disabled]="isSaving"
                                         [placeholder]="'0013131....'"
                                         [valueChangeEvent]="'input'"
                                         [(value)]="profileGeneralInfo.name"
                                         (onValueChanged)="dataChanged()">
                            </dx-text-box>
                        </div>

                        <!-- <div class="call-forwarding d-flex align-items-center">
                            <dx-switch [disabled]="isSaving || !phoneNumberDataSource.postfix"
                                       [(value)]="profileGeneralInfo.isEnableCallForwarding"
                                       (onValueChanged)="dataChanged()">
                            </dx-switch>
                            <span class="switch-label">Call Forwarding</span>
                            <app-help-text class="ml-2"
                                           [targetClass]="'profile-general-info-call-forwarding__tooltip'"
                                           [position]="'top'"
                                           [tooltipWidth]="190">
                                When a contact calls the WooSender number, the call will be forwarded to their
                                <span class="font-weight-bold">Assignee’s phone number.</span>
                            </app-help-text>
                        </div> -->
                    </div>

                    <div class="left-section">
                        <div class="section-summary__title pb-24-c">Thông tin đăng nhập</div>
                        <div class="box-properties">
                            <span class="field-label">Địa chỉ Email</span>
                            <div class="profile-general-info__email-field-container">
                                <dx-text-box #accountEmailTextBox
                                             class="field-box"
                                             [disabled]="isSaving"
                                             [placeholder]="'Enter Email'"
                                             [valueChangeEvent]="'input'"
                                             [(value)]="profileGeneralInfo.email"
                                             (onValueChanged)="onEmailChanged($event)">
                                    <dx-validator #emailValidator>
                                        <dxi-validation-rule type="required"
                                                             [message]="'This email is required'">
                                        </dxi-validation-rule>
                                        <dxi-validation-rule type="email"
                                                             [message]="'This email is invalid'">
                                        </dxi-validation-rule>
                                        <dxi-validation-rule type="custom"
                                                             [reevaluate]="true"
                                                             [message]="'This email already belongs to another account'"
                                                             [validationCallback]="emailExistedValidationCallback">
                                        </dxi-validation-rule>
                                    </dx-validator>
                                </dx-text-box>
                            </div>
                        </div>

                        <div class="box-properties">
                            <span class="field-label">Mật khẩu</span>
                            <div class="profile-general-info-title password-wrap d-flex">
                                <app-custom-button class="change-password"
                                                   [height]="32"
                                                   [disabled]="isSaving"
                                                   [type]="'primary-outline'"
                                                   [text]="'Đổi mật khẩu'"
                                                   (onClick)="openChangePassword()">
                                </app-custom-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pt-40-c pb-15-c">
                <app-custom-button class="mr-10-c"
                                   icon="{{ isSaving ? 'fas fa-spinner fa-spin' : '' }}"
                                   [width]="120"
                                   [height]="40"
                                   [text]="'Lưu'"
                                   [type]="'primary'"
                                   [disabled]="!(isDataChanged && isDataValid) || isSaving"
                                   (onClick)="updateProfileGeneralInfo()">
                </app-custom-button>
                <app-custom-button [width]="120"
                                   [height]="40"
                                   [text]="'Hủy'"
                                   [type]="'cancel'"
                                   [disabled]="isSaving || !isDataChanged"
                                   (onClick)="cancelUpdate()">
                </app-custom-button>
            </div>
        </div>
    </dx-scroll-view>
</div>

<ng-container *ngIf="isShowChangePasswordPopup">
    <app-change-password #changePasswordComponent
                         [(visible)]="isShowChangePasswordPopup">
    </app-change-password>
</ng-container>
